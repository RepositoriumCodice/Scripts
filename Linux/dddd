Setup Pihole WO Reverse Proxy On Portainer

Source: https://www.smarthomebeginner.com/run-pihole-in-docker-on-ubuntu-with-reverse-proxy/

docker pull pihole/pihole:latest


disable and stop Ubuntu's DNS resolver using the following two commands:

sudo systemctl disable systemd-resolved.service
sudo systemctl stop systemd-resolved.service

Open network manager configuration using the following command for editing:

sudo nano /etc/NetworkManager/NetworkManager.conf
Add dns=default under [main] so that the file contents look like what is shown below:

[main]
plugins=ifupdown,keyfile
dns=default
...

Remove or even better rename /etc/resolv.conf file (it is a symbolic link) using the the following command:

sudo mv /etc/resolv.conf /etc/resolv.conf.bak


Restart your network manager using the following command.

sudo service network-manager restart

Using portainer create the following stack:
-------------
 pihole:
    container_name: pihole
    domainname: docker
    hostname: pihole
    image: pihole/pihole:latest
    ports:
      - '53:53/tcp'
      - '53:53/udp'
      # - '67:67/udp'
      - '80:80'
      - '443:443'
    restart: unless-stopped
    volumes:
      - /mnt/containers/pihole:/etc/pihole
      - /mnt/containers/pihole/pihole.log:/var/log/pihole.log
      - /mnt/containers/pihole/dnsmasq.d:/etc/dnsmasq.d
    cap_add:
      - NET_ADMIN
    environment:
      - ServerIP=192.168.0.100
      - TZ=${TZ}
      - WEBPASSWORD=PIHOLEWEBPASSWORD
      - DNS1=127.0.0.1
      - DNS2=1.1.1.1
-------------


On your router:

DHCP->DHCP Settings->Set Primary/Secondary DNS
Advanced Routing->Static Routing

ID	Destination Network			Subnet Mask			Default Gateway
1	8.8.8.8						255.255.255.255		192.168.0.100	
2	8.8.4.4						255.255.255.255		192.168.0.100	
